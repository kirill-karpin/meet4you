@page "/list"
@inject ProfileService profileService
@inject LocationService locationService
@using BlazorApp.Models;
@using BlazorApp.Models.List


<PageTitle>List</PageTitle>

<RadzenCard class="my-4">
    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Start" Wrap="FlexWrap.Wrap">
        <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
            <RadzenText Text="Страна" TextStyle="TextStyle.Subtitle1" TextAlign="TextAlign.Left"></RadzenText>
            <RadzenDropDown TValue="string" TextProperty="Name" ValueProperty="Id"
                            Data=@countries Size="ButtonSize.Small" Change="@OnChangeAsync" />
        </RadzenStack>
        <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
            <RadzenText Text="Город" TextStyle="TextStyle.Subtitle1" TextAlign="TextAlign.Left"></RadzenText>
            <RadzenDropDown TValue="string" TextProperty="Name" ValueProperty="Id"
                            Data=@cities Size="ButtonSize.Small" />
        </RadzenStack>
        <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
            <RadzenText Text="Пол" TextStyle="TextStyle.Subtitle1" TextAlign="TextAlign.Left"></RadzenText>
            <RadzenDropDown Data="@genders" @bind-Value="@gender">
                <Template>
                    @Enum.GetName(typeof(Gender), context)
                </Template>
            </RadzenDropDown>
        </RadzenStack>
        <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
            <RadzenText Text="Семейное положение" TextStyle="TextStyle.Subtitle1" TextAlign="TextAlign.Left" TagName="TagName.H2"></RadzenText>
            <RadzenDropDown Data="@statuses" @bind-Value="@status" Size="ButtonSize.Small">
                <Template>
                    @Enum.GetName(typeof(FamilyStatus), context)
                </Template>
            </RadzenDropDown>
        </RadzenStack>
        <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
            <RadzenText TextStyle="TextStyle.Subtitle1" TextAlign="TextAlign.Left"> Возраст @range.First() - @range.Last() </RadzenText>
                <RadzenSlider Range="true" Min="18" Max="65" @bind-Value=@range TValue="IEnumerable<int>" Style="margin-top: 16px;" />
            </RadzenStack>
            <RadzenStack Orientation="Orientation.Vertical" Gap="4px">
                <RadzenText Text="Дети" TextStyle="TextStyle.Subtitle1" TextAlign="TextAlign.Left" TagName="TagName.H2"></RadzenText>
                <RadzenSwitch @bind-Value="@hasChildren" Style="margin-top: 10px;" />
            </RadzenStack>
            <RadzenStack Orientation="Orientation.Vertical" Style="" Gap="4px">
                <RadzenButton Text="Поиск" Click=@GetProfiles Style="margin-top: 36px; width: 140px; height: 40px" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>


    <RadzenDataList Style="height:400;overflow:auto;"
                    WrapItems="true" AllowPaging="true"
                    Data="@profiles" TItem="ProfileResponse" PageSize="7" PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true">
        <Template Context="profile">
            <RadzenCard Style="width: 50%; padding: 0;">
                <RadzenRow Gap="0">
                    <RadzenColumn Size="12" SizeLG="7" Class="rz-p-4">
                        <RadzenRow Gap="0">
                            <RadzenColumn Size="12" SizeMD="6" SizeLG="2">
                                <RadzenImage Path="user.png" Style="width: 80px; height: 80px; border-radius: 50%" />
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeMD="6" SizeLG="2">
                                <RadzenText TextStyle="TextStyle.H6" TagName="TagName.H5" Class="rz-mb-0">Username</RadzenText>
                                <RadzenText TextStyle="TextStyle.Body2">@("City, Age")</RadzenText>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeLG="2" Class="rz-p-4">
                                <RadzenRow Gap="6px">
                                    <RadzenButton Text="Написать" Style="width: 100%" />
                                </RadzenRow>
                            </RadzenColumn>
                            <RadzenColumn Size="12" SizeLG="2" Class="rz-p-4">
                                <RadzenRow Gap="6px">
                                    <RadzenButton Text="Профиль" Style="width: 100%" />
                                </RadzenRow>
                            </RadzenColumn>
                        </RadzenRow>
                    </RadzenColumn>


                </RadzenRow>
            </RadzenCard>
        </Template>
    </RadzenDataList>

    @code {
    IEnumerable<FamilyStatus> statuses = Enum.GetValues(typeof(FamilyStatus)).Cast<FamilyStatus>();
    FamilyStatus status = FamilyStatus.Свободен;

    IEnumerable<Gender> genders = Enum.GetValues(typeof(Gender)).Cast<Gender>();
    Gender gender = Gender.Ж;

    bool hasChildren;
    IEnumerable<int> range = new int[] { 18, 65 };

    CountryResponse[]? countries;
    CityResponse[]? cities;
    ProfileResponse[] profiles;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        countries = await locationService.GetCountries();
    }

    public async Task OnChangeAsync(object value)
    {
        if (value == null)
            cities = null;
        else
            cities = await locationService.GetCitiesByCountryId((Guid)value);
    }

    public async Task GetProfiles()
    {
        profiles = await profileService.GetListProfile(gender == Gender.Ж ? false : true, status, hasChildren, range.First(), range.Last());
    }



}

